<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Tenant Applications</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f3f4f6;
      padding: 24px;
    }
    .container {
      max-width: 960px;
      margin: 0 auto;
    }
    h1 {
      font-size: 26px;
      font-weight: 600;
      margin-bottom: 16px;
      color: #111827;
    }
    .card {
      background: #ffffff;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      padding: 16px 18px;
      margin-bottom: 12px;
      box-shadow: 0 2px 8px rgba(15, 23, 42, 0.06);
    }
    .row-top {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: wrap;
    }
    .name {
      font-weight: 600;
      font-size: 15px;
      color: #111827;
    }
    .meta {
      font-size: 13px;
      color: #4b5563;
    }
    .status-pill {
      display: inline-block;
      padding: 2px 10px;
      border-radius: 999px;
      font-size: 12px;
      text-transform: capitalize;
    }
    .status-pending {
      background: #fef9c3;
      color: #92400e;
    }
    .status-accepted {
      background: #dcfce7;
      color: #166534;
    }
    .status-rejected {
      background: #fee2e2;
      color: #b91c1c;
    }
    .actions {
      margin-top: 10px;
    }
    button {
      border: none;
      border-radius: 8px;
      padding: 6px 10px;
      font-size: 13px;
      cursor: pointer;
      margin-right: 6px;
    }
    .btn-accept {
      background: #22c55e;
      color: #ffffff;
    }
    .btn-reject {
      background: #ef4444;
      color: #ffffff;
    }
    .btn-refresh {
      background: #2563eb;
      color: #ffffff;
      margin-bottom: 16px;
    }
    .small {
      font-size: 12px;
      color: #6b7280;
      margin-top: 4px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Tenant Applications</h1>
    <button id="refreshBtn" class="btn-refresh">Refresh</button>
    <div id="list"></div>
  </div>

  <script>
    async function fetchApps() {
      const list = document.getElementById("list");
      list.innerHTML = "Loading…";

      const res = await fetch("/api/applications");
      const data = await res.json();

      if (!Array.isArray(data) || data.length === 0) {
        list.innerHTML = "<p>No applications yet.</p>";
        return;
      }

      list.innerHTML = "";

      data.forEach(app => {
        const card = document.createElement("div");
        card.className = "card";

        const created = app.created_at ? new Date(app.created_at).toLocaleString() : "";

        card.innerHTML = `
          <div class="row-top">
            <div>
              <div class="name">${app.name || "Unnamed applicant"}</div>
              <div class="meta">${app.email || ""} ${app.phone ? " • " + app.phone : ""}</div>
              <div class="small">
                Property: ${app.property_address || "—"}<br>
                Move-in: ${app.move_in_date || "—"}<br>
                Submitted: ${created}
              </div>
            </div>
            <div>
              <span class="status-pill status-${app.status}">
                ${app.status}
              </span>
            </div>
          </div>
          <div class="actions">
            <button class="btn-accept">Accept</button>
            <button class="btn-reject">Reject</button>
          </div>
        `;

        const acceptBtn = card.querySelector(".btn-accept");
        const rejectBtn = card.querySelector(".btn-reject");

        acceptBtn.addEventListener("click", () => updateStatus(app.id, "accepted"));
        rejectBtn.addEventListener("click", () => updateStatus(app.id, "rejected"));

        list.appendChild(card);
      });
    }

    async function updateStatus(id, status) {
      await fetch(`/api/applications/${id}`, {
        method: "PATCH",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ status }),
      });
      fetchApps();
    }

    document.getElementById("refreshBtn").addEventListener("click", fetchApps);

    // Initial load
    fetchApps();
  </script>
</body>
</html>
